const admin = require('firebase-admin');
const dotenv = require('dotenv');
const path = require('path');
const fs = require('fs');

// Load biáº¿n mÃ´i trÆ°á»ng tá»« .env
dotenv.config();

// Khá»Ÿi táº¡o Firebase Admin SDK
const serviceAccount = require(path.join(__dirname, 'config/firebase-service-account.json'));

admin.initializeApp({
    credential: admin.credential.cert(serviceAccount),
    storageBucket: process.env.FIREBASE_STORAGE_BUCKET,
});

const bucket = admin.storage().bucket();

// ÄÆ°á»ng dáº«n file PDF cáº§n upload (thay Ä‘á»•i theo file cá»§a báº¡n)
const filePath = path.join(__dirname, 'HelloWorld.pdf'); // Äáº£m báº£o cÃ³ file test.pdf trong thÆ° má»¥c nÃ y
const destination = `resumes/test_${Date.now()}.pdf`; // TÃªn file trÃªn Firebase Storage

async function uploadFile() {
    try {
        // Kiá»ƒm tra file cÃ³ tá»“n táº¡i khÃ´ng
        if (!fs.existsSync(filePath)) {
            console.error('File khÃ´ng tá»“n táº¡i, hÃ£y kiá»ƒm tra láº¡i Ä‘Æ°á»ng dáº«n.');
            return;
        }

        console.log('Äang upload file:', filePath);

        // Upload file lÃªn Firebase Storage
        await bucket.upload(filePath, {
            destination,
            metadata: {
                contentType: 'application/pdf',
            },
        });

        console.log(`âœ… File Ä‘Ã£ Ä‘Æ°á»£c upload thÃ nh cÃ´ng: ${destination}`);

        // Láº¥y URL cÃ´ng khai (signed URL)
        const file = bucket.file(destination);
        const [url] = await file.getSignedUrl({
            action: 'read',
            expires: '03-01-2030', // Set ngÃ y háº¿t háº¡n
        });

        console.log('ğŸ“Œ Public URL:', url);
    } catch (error) {
        console.error('ğŸš¨ Lá»—i khi upload file:', error);
    }
}

uploadFile();
